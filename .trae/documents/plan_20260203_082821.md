# WebSocket客户端打印方案实现计划

## 1. 服务器端修改

### 1.1 修改OrderGateway
- **添加打印通知方法**：在`order.gateway.ts`中添加`notifyPrintOrder`方法
- **广播打印事件**：当新订单创建时，广播`print-order`事件到所有连接的客户端
- **事件数据结构**：包含订单信息和打印内容

### 1.2 修改OrderService
- **调用打印通知**：在`printOrder`方法中调用`orderGateway.notifyPrintOrder`
- **传递打印内容**：将生成的打印内容传递给WebSocket事件
- **保持原有逻辑**：保留本地打印作为备选方案

## 2. 客户端实现

### 2.1 创建打印客户端脚本
- **文件位置**：`apps/server/scripts/print-client.js`
- **功能**：
  - 连接到服务器的WebSocket服务
  - 监听`print-order`事件
  - 接收打印任务并执行本地打印
  - 支持ESC/POS和TXT两种打印格式
  - 错误处理和日志记录

### 2.2 客户端配置
- **配置文件**：`apps/server/scripts/print-client-config.json`
- **配置项**：
  - 服务器WebSocket地址
  - 本地打印机类型（ESC/POS或TXT）
  - 打印机连接信息（USB或网络）
  - 日志级别

## 3. 部署方案

### 3.1 服务器部署
- **修改现有代码**：应用上述服务器端修改
- **重启服务**：确保WebSocket服务正常运行

### 3.2 客户端部署
- **在需要打印的电脑上**：
  1. 安装Node.js环境
  2. 复制打印客户端脚本和配置文件
  3. 安装依赖（escpos、node-printer等）
  4. 配置连接信息
  5. 启动客户端脚本

## 4. 测试流程

### 4.1 连接测试
- 客户端连接到服务器
- 验证连接状态

### 4.2 打印测试
- 创建测试订单
- 验证客户端接收打印任务
- 验证本地打印机执行打印

### 4.3 故障恢复测试
- 模拟网络中断
- 验证客户端自动重连
- 验证打印任务不丢失

## 5. 优势

- **多电脑支持**：多个客户端可以同时接收打印任务
- **灵活配置**：每个客户端可以使用不同类型的打印机
- **可靠性高**：一台电脑故障不影响其他电脑
- **易于扩展**：新电脑加入只需安装客户端
- **实时通知**：打印任务实时推送到客户端

此方案完全适配多电脑环境，提供了一种灵活、可靠的跨设备打印解决方案。